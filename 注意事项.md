# 重整化群笔记 - 开发注意事项

https://github.com/Liu-Zhihang/Renormalization-Group/

> 参考 [Self-Organization-and-Pattern-Formation 的注意事项](https://github.com/Liu-Zhihang/Self-Organization-and-Pattern-Formation/)。本文档记录本项目开发中的约定与避坑要点。

---

## 1. 视频显示问题

### 1.1 视频路径规则

**中文笔记**（`docs/cn/*.md`）中引用视频：

```html
<video controls width="100%">
  <source src="assets/images/video_name.mp4" type="video/mp4">
</video>
```

> 所有视频统一放在 `docs/cn/assets/images/`。

### 1.2 视频文件命名

- **避免**：空格、重音字符、中文字符
- **推荐**：`model_a_dynamics.mp4`、`percolation_3d.mp4` 等（下划线、英文、无空格）

### 1.3 视频路径脚本

`docs/assets/javascripts/video-init.js` 会修正视频路径。若无法播放，请检查：文件是否已提交、路径是否正确、文件名是否含特殊字符。

---

## 2. 导航配置（当前仅中文）

使用 `mkdocs-static-i18n` 时，中文导航放在 `plugins` → `i18n` → `languages` → `zh` → `nav` 下；顶层 `nav` 与之一致即可（当前仅构建中文）。若日后增加英文，英文条目只放在顶层 `nav`，中文只放在 `zh.nav`，避免中英混在一起。

---

## 3. 公式渲染问题

### 3.1 公式块

LaTeX 公式块 `$$...$$` **前后必须有空行**：

```markdown
这是一段文字。

$$
f(x) = x^2 + 1
$$

这是下一段文字。
```

### 3.2 公式块内部

公式内容与结束的 `$$` 之间**不能有空行**。

### 3.3 行内公式

行内公式用单个 `$` 包裹，前后不需要空行。

---

## 4. GitHub Actions 构建

- **不要使用** `mkdocs build --strict`，否则 i18n 下会因“页面未在 nav 中”报错导致失败。
- 已在 `.github/workflows/deploy.yml` 中使用 `mkdocs build`（无 `--strict`）。

### 本地测试

```bash
mkdocs build   # 检查能否成功构建
mkdocs serve   # 本地预览
```

---

## 5. 文件命名规范

- **中文笔记**：`docs/cn/`，格式 `序号.标题.md`，如 `1.什么是重整化群.md`。
- **图片/视频**：`docs/cn/assets/images/`，建议 `章节号_序号_描述.扩展名` 或英文文件名。

---

## 6. 图片引用路径

- **中文笔记中**：`![描述](assets/images/xxx.png)`
- 若从原笔记迁移，注意将外链或本地路径改为站内 `assets/images/`，保证部署后稳定显示。

---

## 7. 首页

- 默认首页：`docs/index.md`
- 中文首页：`docs/index.zh.md`
- 首页引用资源时使用：`cn/assets/images/xxx.png` 或 `cn/assets/images/xxx.mp4`。

---

## 8. 其他

- **Linux 区分大小写**：Git 与 Actions 在 Linux 上运行，文件名与引用路径大小写须一致。
- **大文件**：视频若超过约 50MB，可考虑 Git LFS（`git lfs track "*.mp4"` 等）。
- **本地预览乱码**：Windows 终端可执行 `chcp 65001` 使用 UTF-8。

---

## 9. 图片本地化与去重

- **删除重复图片**（后缀 `_1`、`_1_2` 等）：在 `docs/cn/assets/images/` 下运行 `python cleanup_duplicates_only.py`，会删除重复文件并重建 `download_log.json`（无网络）。
- **补全下载**：再运行 `python download_images.py`，然后运行 `python replace_image_urls.py` 将笔记中的 URL 替换为本地路径。

## 10. 快速排错

| 问题           | 检查项                                       |
|----------------|----------------------------------------------|
| 视频不播放     | 路径、文件名特殊字符、是否已提交             |
| 公式显示为代码 | `$$` 前后是否空行、公式内是否多余空行         |
| Actions 失败   | 是否用了 `--strict`、本地 `mkdocs build` 是否通过 |
| 图片不显示     | 路径、大小写、是否在 `docs/cn/assets/images/`    |
| 部分图片未替换 | 先运行 `download_images.py` 再运行 `replace_image_urls.py`；未找到的 URL 需手动下载或检查网络 |

---

*参考自 Self-Organization-and-Pattern-Formation 注意事项，适配 Renormalization-Group。最后更新：2026-02-03*
